#!/bin/bash

# Ensure all JavaScript files staged for commit pass standard code style
function xargs-r() {
  # Portable version of "xargs -r". The -r flag is a GNU extension that
  # prevents xargs from running if there are no input files.
  if IFS= read -r -d $'\n' path; then
    { echo "$path"; cat; } | xargs $@
  fi
}
git diff --name-only --cached --relative | grep '\.jsx\?$' | sed 's/[^[:alnum:]]/\\&/g' | xargs-r -E '' -t standard -v --fix --global "$" --global "bugsnagClient" --global "uuidv4" --global "switchPage" --global "firebase" --global "Template7" --global "db" --global "load404" --global "genericError" --global "Checklist" --global "List" --global "Embed" --global "Quote" --global "Title" --global "SubTitle" --global "showFatalErrorPage" --global "config" --global "authenticationReadyFailCount" --global "initAdminCMSPages" --global "authenticationReady" --global "authenticationCheckStatus" --global "fetchHeaderParks" --global "cmsPageDoc" --global "fetchParkInfoCards" --global "renderCMSPage" --global "fetchFirebaseAuthRedirectResult" --global "initRidecountPage" --global "initRidecountUserPage" --global "initAdminParksPage" --global "initAdminParksSubmissionsPage" --global "initAdminParksNewPage" --global "initAdminCMSPagesPage" --global "swal" --global "moment" --global "stateurl" --global "EditorJS" --global "Table" --global "Header" --global "LinkTool" --global "RawTool" --global "ImageTool"
if [[ $? -ne 0 ]]; then
  echo 'JavaScript Standard Style errors were detected. Aborting commit.'
  exit 1
fi
